---
title: "Exploratory Data Analysis of School Shooting Data"
author: "Melissa Juarez"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document; pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Research Question: Using a logit model, how do X, Y, and Z variables affect the likelihood that there will be a victim in a school shooting incident?

```{r}
library(here)
library(readxl)
library(dplyr)
library(ggplot2)

## source functions and variables from prior scripts
source(here::here("code/functions.R"))
source(here::here("code/01_tidy.R"))
```


## Visualizing Missingness in Variables across all datasets

The goal of this project is identify variables of interest that might help us understand the likelihood of a shooting incident resulting in a victim. The incidents in the dataset span over a time frame of 40 years, and we first should look at the missingness across variables in our dataset to assess the viability of using certain variables in our model.

We'll visualize the missingness across each of the 4 datasets (incident_df, shooter_df, victim_df, weapon_df)

```{r}
library(naniar)

vis_miss(incident_df)
```


```{r}
vis_miss(shooter_df)
```

```{r}
vis_miss(victim_df)
```

```{r}
vis_miss(weapon_df)
```



```{r}
model_df <- model_df %>% 
  select(-sources, -number_news, -media_attention, -reliability, -summary, -active_shooter_fbi, 
         -narrative, -situation, -barricade, -hostages, -gang_related, -accomplice)
vis_miss(model_df)
```



## Exploring Dependent Variable
Our Dependent Variable will be victim counts, so let's explore the distribution of victim counts for school shootings 1970-2022.

```{r}
ggplot(model_df, aes(x=as.numeric(sub("%", "",victim_count,fixed=TRUE)))) + 
  geom_histogram(aes(y=..density..), color="darkblue", fill="lightblue", binwidth = 1) + 
  geom_density(alpha=.2, fill="#FF6666") +
  geom_vline(aes(xintercept=median(as.numeric(sub("%", "",victim_count,fixed=TRUE)))),
             color="black", linetype="dashed", size=0.5) +
  labs(title="Distribution of Victim Count for School Shooting resulting in more than 1 victim",
       x ="Victim Count", y = "Density")
```

Most school shooting between 1970-2022 between 0 and 2 victims.

```{r}
one_var_tabyl(incident_df, school_level) %>% k()
```



## POSSIBLE INDEPENDENT VARIABLES

-   gender of shooter
-   `target`: whether there were any victims targets or random
-   `bullied`: whether any shooter was bullied; rational to target bullying & mental health counselors access
-   `preplanned`
-   school level
-   during school hours?

### Gender of Shooter

```{r}
one_var_tabyl(model_df, school_level) %>% k()
```

### school level

```{r}
one_var_tabyl(model_df, school_level) %>% k()
```



## Initial Models

```{r}
sub_df <- model_df %>% select(victim_count, bullied , during_school , shooter_count , multiple_weapons , handgun_used , rifle_used , shotgun_used) %>% na.omit()
cor(sub_df)

attach(sub_df)
m1 <- lm(victim_count ~ bullied + during_school + shooter_count + multiple_weapons + handgun_used + rifle_used + shotgun_used)

car::vif(m1)

summary(m1)
```

```{r}
lm(rifle_used ~ handgun_used) %>% summary()
```

